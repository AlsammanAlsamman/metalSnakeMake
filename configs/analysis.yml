# Meta-analysis configuration

project_name: "metal-meta-analysis"
version: "0.1.0"
results_dir: "/s/nath-lab/alsamman/____MyCodes____/metalSnakeMake/results"

# Target genome build - all datasets will be converted to this build
target_build: "hg38"  # Options: hg19, hg38
target_snp_list: ""  # Reference SNP list for filtering and annotation
markername_format: "chrom:pos:snpid"  # Format for METAL MarkerName column (options: chrom:pos:snpid, chrom:pos, snpid)
datasets:

  Chb1f:
    file: "input/Chb1f.plink2"
    format: "plink2"
    build: "hg38"
    study_type: "GWAS"
    columns:
      snpid: "ID"
      chrom: "#CHROM"
      pos: "POS"
      ea: "A1"
      nea: "REF"
      eaf: "A1_CASE_FREQ"
      or: "OR"
      se: "LOG(OR)_SE"
      p: "P"
      n: "OBS_CT"

  Chb1m:
    file: "input/Chb1m.plink2"
    format: "plink2"
    build: "hg38"
    study_type: "GWAS"
    columns:
      snpid: "ID"
      chrom: "#CHROM"
      pos: "POS"
      ea: "A1"
      nea: "REF"
      eaf: "A1_CASE_FREQ"
      or: "OR"
      se: "LOG(OR)_SE"
      p: "P"
      n: "OBS_CT"

  Chb2f:
    file: "input/Chb2f.plink2"
    format: "plink2"
    build: "hg38"
    study_type: "GWAS"
    columns:
      snpid: "ID"
      chrom: "#CHROM"
      pos: "POS"
      ea: "A1"
      nea: "REF"
      eaf: "A1_CASE_FREQ"
      or: "OR"
      se: "LOG(OR)_SE"
      p: "P"
      n: "OBS_CT"

  Chb2m:
    file: "input/Chb2m.plink2"
    format: "plink2"
    build: "hg38"
    study_type: "GWAS"
    columns:
      snpid: "ID"
      chrom: "#CHROM"
      pos: "POS"
      ea: "A1"
      nea: "REF"
      eaf: "A1_CASE_FREQ"
      or: "OR"
      se: "LOG(OR)_SE"
      p: "P"
      n: "OBS_CT"

  Chb3f:
    file: "input/Chb3f.plink2"
    format: "plink2"
    build: "hg38"
    study_type: "GWAS"
    columns:
      snpid: "ID"
      chrom: "#CHROM"
      pos: "POS"
      ea: "A1"
      nea: "REF"
      eaf: "A1_CASE_FREQ"
      or: "OR"
      se: "LOG(OR)_SE"
      p: "P"
      n: "OBS_CT"

  Chb3m:
    file: "input/Chb3m.plink2"
    format: "plink2"
    build: "hg38"
    study_type: "GWAS"
    columns:
      snpid: "ID"
      chrom: "#CHROM"
      pos: "POS"
      ea: "A1"
      nea: "REF"
      eaf: "A1_CASE_FREQ"
      or: "OR"
      se: "LOG(OR)_SE"
      p: "P"
      n: "OBS_CT"

  Chb4f:
    file: "input/Chb4f.plink2"
    format: "plink2"
    build: "hg38"
    study_type: "GWAS"
    columns:
      snpid: "ID"
      chrom: "#CHROM"
      pos: "POS"
      ea: "A1"
      nea: "REF"
      eaf: "A1_CASE_FREQ"
      or: "OR"
      se: "LOG(OR)_SE"
      p: "P"
      n: "OBS_CT"

  Chb4m:
    file: "input/Chb4m.plink2"
    format: "plink2"
    build: "hg38"
    study_type: "GWAS"
    columns:
      snpid: "ID"
      chrom: "#CHROM"
      pos: "POS"
      ea: "A1"
      nea: "REF"
      eaf: "A1_CASE_FREQ"
      or: "OR"
      se: "LOG(OR)_SE"
      p: "P"
      n: "OBS_CT"






  # Asian:
  #   file: "input/Asian_mapped.tsv"
  #   build: "hg19"
  #   reference_panel: "EAS"  # Reference panel for allele frequency and LD (from software.yml)
  #   study_type: "GWAS"
  #   columns:
  #     snpid: "snpid"                 # SNP identifier (using MarkerName as proxy for rsID)
  #     variant_id: "MarkerName"                 # SNP identifier (using MarkerName as proxy for rsID)
  #     chrom: "chrom"                        # Chromosome
  #     pos: "pos"                          # Position
  #     ea: "ea"                       # Effect allele
  #     nea: "nea"                      # Non-effect/other allele
  #     beta: "beta"                      # Beta coefficient (available as Effect)
  #     se: "se"                        # Standard error
  #     p: "p"                        # P-value
  #     n: "n"                # Total sample size
  #     n_cases: "14703"                      # Number of cases (not provided, set to NA)
  #     n_controls: "144900"                   # Number of controls (not provided, set to NA
  #     n_sample_size: "159603"                    # Sample size per variant (not provided, set to NA)
  # EUR:
  #   file: "input/EURstdrCleanBJ_with_freq.tsv"
  #   build: "hg19"
  #   n_cases: 4036
  #   n_controls: 6959
  #   study_type: "GWAS"  # Or META if this is meta-analysis result
  #   columns:
  #     snpid: "MarkerName:3"                 # SNP identifier
  #     variant_id: "variant_id"            # Variant ID (chrom:pos format)
  #     chrom: "chr"                        # Chromosome
  #     pos: "pos"                          # Position
  #     ea: "Allele2"                       # Effect allele
  #     nea: "Allele1"                      # Non-effect/other allele
  #     beta: "Effect"                      # Beta coefficient
  #     se: "StdErr"                        # Standard error
  #     p: "P-value"                        # P-value
  #     het_i2: "HetISq"                    # Heterogeneity I² statistic
  #     het_pval: "HetPVal"                 # Heterogeneity p-value
  #     direction: "Direction"              # Direction of effects
  # Hisp: 
  #   file: "input/Hisp.tsv"
  #   build: "hg38"
  #   n_cases: 3018
  #   n_controls: 5501
  #   study_type: "META"  # Meta-analysis result
  #   columns:
  #     snpid: "snpid"                      # SNP identifier
  #     chrom: "chrom"                      # Chromosome
  #     pos: "pos"                          # Position
  #     ea: "nea"                            # Effect allele
  #     nea: "ea"                          # Non-effect/other allele
  #     eaf: "eaf"                          # Effect allele frequency
  #     beta: "beta"                        # Beta coefficient
  #     se: "se"                            # Standard error
  #     p: "p"                              # P-value
  #     direction: "direction"              # Direction of effects
  #     het_i2: "het_isq"                   # Heterogeneity I² statistic
  #     het_chisq: "het_chisq"              # Heterogeneity chi-square
  #     het_df: "het_df"                    # Heterogeneity degrees of freedom
  #     het_pval: "het_pval"                # Heterogeneity p-value
  #     markername: "markername"            # MarkerName

  # TWN:
  #   file: "input/TWN.txt"
  #   build: "hg38"
  #   n_cases: 5184
  #   n_controls: 311848
  #   study_type: "GWAS"
  #   columns:
  #     chrom: "CHR"
  #     pos: "POS"
  #     ea: "Allele2"
  #     nea: "Allele1"
  #     eaf: "AF_Allele2"
  #     beta: "BETA"
  #     se: "SE"
  #     p: "p.value"
  #     info: "imputationInfo"

#   Hisp:
#     file: "input/Hisp.tsv"
#     build: "hg38"
#     n_cases: 3018
#     n_controls: 5501
#     study_type: "META"  # Meta-analysis result
#     columns:
#       snpid: "snpid"                      # SNP identifier
#       chrom: "chrom"                      # Chromosome
#       pos: "pos"                          # Position
#       ea: "ea"                            # Effect allele
#       nea: "nea"                          # Non-effect/other allele
#       eaf: "eaf"                          # Effect allele frequency
#       beta: "beta"                        # Beta coefficient
#       se: "se"                            # Standard error
#       p: "p"                              # P-value
#       direction: "direction"              # Direction of effects
#       het_i2: "het_isq"                   # Heterogeneity I² statistic
#       het_chisq: "het_chisq"              # Heterogeneity chi-square
#       het_df: "het_df"                    # Heterogeneity degrees of freedom
#       het_pval: "het_pval"                # Heterogeneity p-value
#       markername: "markername"            # MarkerName


#   TWN:
#     file: "input/TWN.txt"
#     build: "hg38"
#     n_cases: 5184
#     n_controls: 311848
#     study_type: "GWAS"
#     columns:
#       chrom: "CHR"
#       pos: "POS"
#       ea: "Allele2"
#       nea: "Allele1"
#       eaf: "AF_Allele2"
#       beta: "BETA"
#       se: "SE"
#       p: "p.value"
#       info: "imputationInfo"
#   MVP:
#     file: "input/MVP.tsv"
#     build: "hg38"
#     n_cases: 1965
#     n_controls: 630574
#     study_type: "GWAS"  # Or META if this is meta-analysis result
#     columns:
#       snpid: "rsid"                       # SNP identifier
#       chrom: "chromosome"                 # Chromosome
#       pos: "base_pair_location"           # Position
#       ea: "effect_allele"                 # Effect allele
#       nea: "other_allele"                 # Non-effect/other allele
#       eaf: "effect_allele_frequency"      # Effect allele frequency
#       or: "odds_ratio"                    # Odds ratio (only OR available, no BETA directly)
#       se: "standard_error"                # SE of log(OR)
#       p: "p_value"                        # P-value
#       n: "n"                              # Total sample size
#       het_i2: "i2"                        # Heterogeneity I² statistic
#       het_pval: "q_pval"                  # Heterogeneity p-value
# # 3018 + 5501 + 4036 + 6959 + 14703 + 144900
# # METAL configuration
metal:
  scheme: "STDERR"  # Options: STDERR (beta/se required) or SAMPLESIZE
  use_eaf: false  # If false, do not pass effect allele frequency (FREQ eaf) to METAL
  # genomiccontrol: "ON"  # Apply genomic control correction (leave commented for manual control)
  min_overlap: 2  # Minimum number of studies required per variant
  study_combinations:
    Asian_EUR: ["Asian", "EUR"]
    Asian_EUR_Hisp: ["Asian", "EUR","Hisp"]  # Include Hispanic meta-analysis in main analysis
    # Asian_EUR_Hisp: ["Asian", "EUR", "Hisp","TWN", "MVP"]  # Combine all studies for main meta-analysis
  
# Quality control thresholds
qc:
  min_info: 0.3      # Minimum imputation quality score
  min_maf: 0.01      # Minimum minor allele frequency
  max_pval: 1.0      # Maximum p-value (typically 1.0 to keep all)
  min_sample_size: 100  # Minimum effective sample size per variant
  het_pval_threshold: 0.001  # Heterogeneity p-value threshold
  max_het_i2: 75     # Maximum I² statistic (0-100)

# Enrichment settings
enrichment:
  mpra:
    file: "resources/MPRA/MPRA_hg38.txt"  # MPRA database file path
    fdr_threshold: 1                    # FDR threshold for filtering MPRA records
    excel_pvalue_threshold: 0.005          # P-value threshold for Excel output (5e-3)
  
  annovar:
    humandb: "resources/annovar/humandb"   # ANNOVAR database directory
    protocols: ["refGene"]                 # Annotation protocols to use
    operations: ["g"]                      # g=gene-based annotation
    excel_pvalue_threshold: 0.005          # P-value threshold for Excel output (5e-3)

# Genomic loci identification settings
# Each study combination specifies its reference panel and LD parameters
loci_identification:
  Asian_EUR:
    reference_panel: "1000G_EUR"  # Reference panel name from software.yml
    panel_match_p_threshold: 5e-3   # P-value cutoff used to build markernamepanel table before loci identification
    leadP: 5e-8                    # P-value threshold for independent significant SNPs
    gwasP: 1e-5                    # P-value threshold for SNPs in LD window
    r2: 0.6                        # LD r² threshold for building candidate windows
    r2_2: 0.1                      # LD r² threshold to group independent SNPs into same lead
    mergeDist: 250                 # Distance (kb) to merge nearby loci
    maf: 0.01                      # Minimum MAF in reference panel
    windowKb: 500                  # Max window (kb) for LD queries
    threads: 8                     # Number of threads for PLINK
    refSNPs: 1                     # Include reference-only SNPs (1=yes, 0=no)









  
  # chi:
  #   reference_panel: "1000G_AMR"
  #   leadP: 5e-8
  #   gwasP: 1e-5
  #   r2: 0.6
  #   r2_2: 0.1
  #   mergeDist: 250
  #   maf: 0.01
  #   windowKb: 500
  #   threads: 8
  #   refSNPs: 1
  
  # eur:
  #   reference_panel: "1000G_EUR"  # Use European reference for EUR meta-analysis
  #   leadP: 5e-8
  #   gwasP: 1e-5
  #   r2: 0.6
  #   r2_2: 0.1
  #   mergeDist: 250
  #   maf: 0.01
  #   windowKb: 500
  #   threads: 8
  #   refSNPs: 1

# Resources paths
resources:
  liftover_chains:
    hg19_to_hg38: "resources/liftover/hg19ToHg38.over.chain.gz"
    hg38_to_hg19: "resources/liftover/hg38ToHg19.over.chain.gz"
    hg18_to_hg19: "resources/liftover/hg18ToHg19.over.chain.gz"
  reference_panels:
    eur_freq: "resources/reference/1000g_EUR.frq.gz"
    all_freq: "resources/reference/1000g_ALL.frq.gz"

# Visualization settings
visualization:
  manhattan:
    significance_threshold: 5e-8
    suggestive_threshold: 1e-5
    point_size: 1.5
  qq_plot:
    confidence_interval: 0.95
  forest_plot:
    max_variants: 50  # Top N variants to plot

# Default computational resources
default_resources:
  mem_mb: 32000
  cores: 2
  time: "02:00:00"
